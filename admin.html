<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --bg-dark: #212121;
      --bg-light: #1A1D23;
      --accent: #34C759;
      --text: #ffffff;
    }* {
  box-sizing: border-box;
  transition: all 0.3s ease;
}

body {
  margin: 0;
  font-family: 'Poppins', sans-serif;
  background: var(--bg-dark);
  color: var(--text);
}

header {
  background: var(--bg-light);
  padding: 20px;
  text-align: center;
  font-size: 24px;
  font-weight: 700;
  color: var(--accent);
  box-shadow: 0 2px 5px rgba(0,0,0,0.5);
}

.container {
  max-width: 1200px;
  margin: auto;
  padding: 20px;
}

.controls {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  margin-bottom: 15px;
}

input, select, button {
  padding: 8px;
  border-radius: 8px;
  border: none;
  margin: 5px;
  font-size: 14px;
}

button {
  background: var(--accent);
  color: var(--bg-dark);
  font-weight: 600;
  cursor: pointer;
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}

th, td {
  padding: 10px;
  text-align: left;
  border-bottom: 1px solid #333;
  color: #fff;
}

th {
  color: var(--accent);
}

.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0,0,0,0.9);
  color: white;
  overflow-y: auto;
  padding: 30px;
  z-index: 1000;
  display: none;
  flex-direction: column;
}

.modal h3 {
  margin-top: 0;
  color: var(--accent);
}

.modal button {
  background: crimson;
  align-self: flex-end;
}

@media (max-width: 600px) {
  th, td {
    font-size: 12px;
  }
}

  </style>
</head>
<body>
<header>Admin Dashboard</header>
<div class="container">
  <div class="controls">
    <input type="text" id="searchInput" placeholder="Search username/email" />
    <select id="statusFilter">
      <option value="">All Status</option>
      <option value="free">Free</option>
      <option value="premium">Premium</option>
      <option value="banned">Banned</option>
    </select>
  </div>
  <div id="userList">Loading users...</div>
</div>
<div class="modal" id="teamModal">
  <button onclick="closeModal()">Close</button>
  <h3>User's Team</h3>
  <div id="teamList">Loading...</div>
</div><script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import {
    getFirestore, collection, getDocs, getDoc, updateDoc, doc, query, where
  } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCu09APwiLAjUp6ZITHarv1gJFk7eWRgtg",
    authDomain: "conectcamp-db2c2.firebaseapp.com",
    projectId: "conectcamp-db2c2",
    storageBucket: "conectcamp-db2c2.appspot.com",
    messagingSenderId: "648442230919",
    appId: "1:648442230919:web:28b61283dbb72f8f966022",
    measurementId: "G-3Q2ZS872YC"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const userList = document.getElementById("userList");
  const searchInput = document.getElementById("searchInput");
  const statusFilter = document.getElementById("statusFilter");

  let allUsers = [];

  async function loadUsers() {
    const snapshot = await getDocs(collection(db, "users"));
    allUsers = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    renderUsers();
  }

  function renderUsers() {
    const search = searchInput.value.toLowerCase();
    const status = statusFilter.value;

    const filtered = allUsers.filter(user => {
      const matchSearch = user.username?.toLowerCase().includes(search) || user.email?.toLowerCase().includes(search);
      const matchStatus = status === '' || user.status === status;
      return matchSearch && matchStatus;
    });

    if (filtered.length === 0) {
      userList.innerHTML = '<p style="color:#ccc">No users found.</p>';
      return;
    }

    let html = `<table>
      <tr>
        <th>Username</th>
        <th>Email</th>
        <th>Coins</th>
        <th>Status</th>
        <th>Referral Code</th>
        <th>Actions</th>
      </tr>`;

    for (const user of filtered) {
      html += `
        <tr>
          <td>${user.username || '-'}</td>
          <td>${user.email || '-'}</td>
          <td>${user.coins || 0}</td>
          <td>${user.status || 'free'}</td>
          <td>${user.referralCode || '-'}</td>
          <td>
            <input type='number' id='coins_${user.id}' placeholder='0' style='width: 60px;' />
            <button onclick='addCoins("${user.id}")'>Add</button>
            <button onclick='banUser("${user.id}")'>Ban</button>
            <button onclick='showTeam("${user.referralCode}")'>Team</button>
          </td>
        </tr>`;
    }

    html += '</table>';
    userList.innerHTML = html;
  }

  window.addCoins = async (uid) => {
    const input = document.getElementById(`coins_${uid}`);
    const addAmount = parseInt(input.value);
    if (!addAmount || addAmount <= 0) return alert("Invalid amount");
    const userRef = doc(db, "users", uid);
    const userSnap = await getDoc(userRef);
    const current = userSnap.data().coins || 0;
    await updateDoc(userRef, { coins: current + addAmount });
    alert("Coins added");
    loadUsers();
  }

  window.banUser = async (uid) => {
    if (!confirm("Ban this user?")) return;
    await updateDoc(doc(db, "users", uid), { status: "banned" });
    alert("User banned");
    loadUsers();
  }

  window.showTeam = async (refCode) => {
    const modal = document.getElementById("teamModal");
    const list = document.getElementById("teamList");
    list.innerHTML = "Loading...";
    modal.style.display = "flex";

    const q = query(collection(db, "users"), where("referredBy", "==", refCode));
    const snapshot = await getDocs(q);
    if (snapshot.empty) {
      list.innerHTML = "<p>No team yet.</p>";
    } else {
      let content = "<ul>";
      snapshot.forEach(doc => {
        const u = doc.data();
        content += `<li><strong>${u.username}</strong> - ${u.email} - ${u.status || 'free'} - ${new Date(u.timestamp?.seconds * 1000 || 0).toLocaleDateString()}</li>`;
      });
      content += "</ul>";
      list.innerHTML = content;
    }
  }

  window.closeModal = () => {
    document.getElementById("teamModal").style.display = "none";
  }

  searchInput.addEventListener("input", renderUsers);
  statusFilter.addEventListener("change", renderUsers);

  loadUsers();
</script></body>
</html>