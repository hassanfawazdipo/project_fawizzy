<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    :root {
      --bg: #212121;
      --card: #1A1D23;
      --accent: #34C759;
      --text: #fff;
    }body {
  font-family: 'Poppins', sans-serif;
  background: var(--bg);
  color: var(--text);
  margin: 0;
  padding: 0;
}

header {
  text-align: center;
  background: var(--card);
  padding: 20px;
  font-size: 24px;
  font-weight: bold;
  color: var(--accent);
}

.container {
  max-width: 1200px;
  margin: auto;
  padding: 20px;
}

table {
  width: 100%;
  border-collapse: collapse;
  background: var(--card);
  border-radius: 12px;
  overflow: hidden;
  margin-top: 20px;
}

th, td {
  padding: 14px;
  text-align: left;
}

th {
  background: #2a2a2a;
  color: var(--accent);
}

tr:nth-child(even) {
  background-color: #2c2c2c;
}

tr:hover {
  background-color: #333;
}

button {
  padding: 5px 10px;
  border: none;
  background: var(--accent);
  color: var(--bg);
  border-radius: 5px;
  cursor: pointer;
}

.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.9);
  color: var(--text);
  overflow-y: auto;
  z-index: 1000;
  padding: 30px;
}

.modal-content {
  background: var(--card);
  border-radius: 10px;
  padding: 20px;
}

.close-modal {
  float: right;
  font-size: 22px;
  cursor: pointer;
  color: red;
}

  </style>
</head>
<body>
  <header>Admin Dashboard</header>
  <div class="container">
    <table id="userTable">
      <thead>
        <tr>
          <th>Username</th>
          <th>Email</th>
          <th>Status</th>
          <th>Referral Code</th>
          <th>Team</th>
        </tr>
      </thead>
      <tbody id="userTableBody">
        <tr><td colspan="5">Loading...</td></tr>
      </tbody>
    </table>
  </div>  <!-- Modal -->  <div id="teamModal" class="modal">
    <div class="modal-content">
      <span class="close-modal" onclick="document.getElementById('teamModal').style.display='none'">&times;</span>
      <h2>Team Members</h2>
      <div id="teamList">Loading...</div>
    </div>
  </div>  <!-- Firebase -->  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCu09APwiLAjUp6ZITHarv1gJFk7eWRgtg",
      authDomain: "conectcamp-db2c2.firebaseapp.com",
      projectId: "conectcamp-db2c2",
      storageBucket: "conectcamp-db2c2.appspot.com",
      messagingSenderId: "648442230919",
      appId: "1:648442230919:web:28b61283dbb72f8f966022"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const userTableBody = document.getElementById("userTableBody");
    const teamList = document.getElementById("teamList");

    function formatDate(timestamp) {
      return timestamp ? timestamp.toDate().toLocaleString() : 'Unknown';
    }

    async function loadUsers() {
      const usersSnapshot = await db.collection("users").get();
      userTableBody.innerHTML = "";

      usersSnapshot.forEach(doc => {
        const user = doc.data();
        const row = `
          <tr>
            <td>${user.username || 'N/A'}</td>
            <td>${user.email || 'N/A'}</td>
            <td>${user.status || 'free'}</td>
            <td>${user.referralCode || '-'}</td>
            <td><button onclick="viewTeam('${user.referralCode}')">Team</button></td>
          </tr>`;
        userTableBody.innerHTML += row;
      });
    }

    async function viewTeam(referralCode) {
      document.getElementById("teamModal").style.display = "block";
      teamList.innerHTML = "<p>Loading team...</p>";
      const teamSnapshot = await db.collection("users").where("referredBy", "==", referralCode).get();

      if (teamSnapshot.empty) {
        teamList.innerHTML = "<p>No team yet.</p>";
        return;
      }

      let html = `<table>
        <thead><tr><th>Email</th><th>Date Referred</th><th>Last Purchase</th><th>Amount</th></tr></thead><tbody>`;

      teamSnapshot.forEach(doc => {
        const data = doc.data();
        html += `
          <tr>
            <td>${data.email || 'N/A'}</td>
            <td>${formatDate(data.registeredAt)}</td>
            <td>${formatDate(data.lastCoinPurchase)}</td>
            <td>â‚¦${data.lastCoinAmount || 0}</td>
          </tr>`;
      });
      html += `</tbody></table>`;
      teamList.innerHTML = html;
    }

    loadUsers();
  </script></body>
</html>
