
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Comparative Statement Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            color: white;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 3.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #fff, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.3)); }
            to { filter: drop-shadow(0 0 30px rgba(240, 147, 251, 0.5)); }
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 15px 25px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .nav-tab:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            background: rgba(255, 255, 255, 0.2);
        }

        .nav-tab.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.15);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(45deg, #667eea, #764ba2, #f093fb);
            border-radius: 20px 20px 0 0;
        }

        .card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
            font-size: 14px;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .statement-row {
            display: grid;
            grid-template-columns: 2fr repeat(4, 1fr) auto;
            gap: 15px;
            margin-bottom: 15px;
            align-items: center;
            padding: 20px;
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            border-left: 5px solid #667eea;
            transition: all 0.3s ease;
        }

        .statement-row:hover {
            transform: translateX(10px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .comparison-table th, .comparison-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .comparison-table th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .comparison-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .comparison-table tr:hover {
            background: #e3f2fd;
            transform: scale(1.01);
        }

        .variance-positive {
            color: #27ae60;
            font-weight: bold;
        }

        .variance-negative {
            color: #e74c3c;
            font-weight: bold;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
        }

        .analysis-panel {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .insight-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
        }

        .insight-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            background: rgba(255, 255, 255, 0.2);
        }

        .ratios-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .ratio-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
        }

        .ratio-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }

        .period-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .period-item {
            flex: 1;
            min-width: 200px;
        }

        .export-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            width: 90%;
            max-height: 90%;
            overflow-y: auto;
        }

        .close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 30px;
            cursor: pointer;
            color: #999;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .template-card {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .template-card:hover {
            background: #e3f2fd;
            border-color: #667eea;
            transform: translateY(-5px);
        }

        .floating-action {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .floating-action:hover {
            transform: scale(1.1) rotate(180deg);
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            .statement-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .nav-tabs {
                flex-direction: column;
                align-items: center;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .comparison-table {
                font-size: 12px;
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .slide-in {
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .highlight {
            background: linear-gradient(45deg, #fff, #f093fb);
            padding: 2px 8px;
            border-radius: 6px;
            animation: highlight 1s ease-in-out;
        }

        @keyframes highlight {
            0% { background: #f093fb; }
            50% { background: #fff; }
            100% { background: #f093fb; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📊 Advanced Comparative Statement Generator</h1>
            <p>Professional Financial Analysis & Comparison Tool with AI-Powered Insights</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('setup')">⚙️ Setup</button>
            <button class="nav-tab" onclick="showTab('data')">📝 Data Entry</button>
            <button class="nav-tab" onclick="showTab('comparison')">📊 Comparison</button>
            <button class="nav-tab" onclick="showTab('analysis')">🧠 Analysis</button>
            <button class="nav-tab" onclick="showTab('charts')">📈 Charts</button>
            <button class="nav-tab" onclick="showTab('ratios')">📐 Ratios</button>
            <button class="nav-tab" onclick="showTab('reports')">📋 Reports</button>
        </div>

        <!-- Setup Tab -->
        <div id="setup" class="tab-content active">
            <div class="grid">
                <div class="card">
                    <h3>🏢 Company Information</h3>
                    <div class="form-group">
                        <label for="companyName">Company Name:</label>
                        <input type="text" id="companyName" placeholder="Enter company name">
                    </div>
                    <div class="form-group">
                        <label for="industry">Industry:</label>
                        <select id="industry">
                            <option value="">Select Industry</option>
                            <option value="manufacturing">Manufacturing</option>
                            <option value="services">Services</option>
                            <option value="retail">Retail</option>
                            <option value="technology">Technology</option>
                            <option value="healthcare">Healthcare</option>
                            <option value="financial">Financial Services</option>
                            <option value="real-estate">Real Estate</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="currency">Currency:</label>
                        <select id="currency">
                            <option value="USD">USD ($)</option>
                            <option value="EUR">EUR (€)</option>
                            <option value="GBP">GBP (£)</option>
                            <option value="JPY">JPY (¥)</option>
                            <option value="INR">INR (₹)</option>
                            <option value="CAD">CAD (C$)</option>
                            <option value="AUD">AUD (A$)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="fiscalYearEnd">Fiscal Year End:</label>
                        <input type="date" id="fiscalYearEnd">
                    </div>
                </div>

                <div class="card">
                    <h3>📅 Comparison Periods</h3>
                    <div class="period-selector" id="periodsContainer">
                        <div class="period-item">
                            <div class="form-group">
                                <label>Period 1:</label>
                                <input type="text" class="period-name" placeholder="e.g., 2023" value="Current Year">
                                <input type="date" class="period-start" placeholder="Start Date">
                                <input type="date" class="period-end" placeholder="End Date">
                            </div>
                        </div>
                        <div class="period-item">
                            <div class="form-group">
                                <label>Period 2:</label>
                                <input type="text" class="period-name" placeholder="e.g., 2022" value="Previous Year">
                                <input type="date" class="period-start" placeholder="Start Date">
                                <input type="date" class="period-end" placeholder="End Date">
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="addPeriod()">➕ Add Period</button>
                    <button class="btn btn-success" onclick="loadTemplate()">📋 Load Template</button>
                </div>
            </div>

            <div class="card">
                <h3>📊 Statement Type & Configuration</h3>
                <div class="form-group">
                    <label for="statementType">Statement Type:</label>
                    <select id="statementType" onchange="loadStatementTemplate()">
                        <option value="income">Income Statement</option>
                        <option value="balance">Balance Sheet</option>
                        <option value="cashflow">Cash Flow Statement</option>
                        <option value="equity">Statement of Equity</option>
                        <option value="custom">Custom Statement</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="reportingUnit">Reporting Unit:</label>
                    <select id="reportingUnit">
                        <option value="1">Individual Units</option>
                        <option value="1000">Thousands</option>
                        <option value="1000000">Millions</option>
                        <option value="1000000000">Billions</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="analysisType">Analysis Type:</label>
                    <select id="analysisType">
                        <option value="horizontal">Horizontal Analysis</option>
                        <option value="vertical">Vertical Analysis</option>
                        <option value="both">Both Horizontal & Vertical</option>
                        <option value="trend">Trend Analysis</option>
                        <option value="ratio">Ratio Analysis</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="initializeStatement()">🚀 Initialize Statement</button>
            </div>
        </div>

        <!-- Data Entry Tab -->
        <div id="data" class="tab-content">
            <div class="card">
                <h3>📝 Financial Data Entry</h3>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="addStatementItem()">➕ Add Line Item</button>
                    <button class="btn btn-success" onclick="importData()">📁 Import from CSV</button>
                    <button class="btn btn-warning" onclick="autoFillSampleData()">🎲 Sample Data</button>
                </div>
                
                <div id="statementContainer">
                    <div class="statement-row">
                        <input type="text" placeholder="Account Name" class="account-name">
                        <input type="number" placeholder="Period 1" class="period-1" step="0.01">
                        <input type="number" placeholder="Period 2" class="period-2" step="0.01">
                        <input type="number" placeholder="Period 3" class="period-3" step="0.01" style="display: none;">
                        <input type="number" placeholder="Period 4" class="period-4" step="0.01" style="display: none;">
                        <select class="account-type">
                            <option value="revenue">Revenue</option>
                            <option value="expense">Expense</option>
                            <option value="asset">Asset</option>
                            <option value="liability">Liability</option>
                            <option value="equity">Equity</option>
                        </select>
                        <button class="btn btn-danger" onclick="removeStatementItem(this)">❌</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>🔄 Data Validation & Processing</h3>
                <div class="export-options">
                    <button class="btn btn-primary" onclick="validateData()">✅ Validate Data</button>
                    <button class="btn btn-success" onclick="calculateTotals()">🧮 Calculate Totals</button>
                    <button class="btn btn-warning" onclick="detectAnomalies()">🔍 Detect Anomalies</button>
                </div>
                <div id="validationResults" style="margin-top: 20px;"></div>
            </div>
        </div>

        <!-- Comparison Tab -->
        <div id="comparison" class="tab-content">
            <div class="card">
                <h3>📊 Comparative Analysis</h3>
                <button class="btn btn-primary" onclick="generateComparison()">🔄 Generate Comparison</button>
                <button class="btn btn-success" onclick="exportComparison()">📤 Export Results</button>
            </div>

            <div class="chart-container">
                <h3>📈 Comparative Statement</h3>
                <div style="overflow-x: auto;">
                    <table class="comparison-table" id="comparisonTable">
                        <thead id="comparisonHeader">
                            <tr>
                                <th>Account</th>
                                <th>Current Year</th>
                                <th>Previous Year</th>
                                <th>Variance ($)</th>
                                <th>Variance (%)</th>
                                <th>Trend</th>
                            </tr>
                        </thead>
                        <tbody id="comparisonBody">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 40px; color: #999;">
                                    No data available. Please enter financial data first.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Analysis Tab -->
        <div id="analysis" class="tab-content">
            <div class="analysis-panel">
                <h3>🧠 AI-Powered Financial Insights</h3>
                <div id="analysisInsights">
                    <div class="insight-item">
                        <div class="insight-icon">💡</div>
                        <div>
                            <h4>Performance Indicator</h4>
                            <p>Your revenue growth shows a positive trend of 15.2% compared to the previous period.</p>
                        </div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-icon">⚠️</div>
                        <div>
                            <h4>Risk Alert</h4>
                            <p>Operating expenses have increased by 8.5%, which is higher than revenue growth. Consider cost optimization.</p>
                        </div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-icon">📈</div>
                        <div>
                            <h4>Growth Opportunity</h4>
                            <p>Your profit margin is above industry average. Consider expanding market presence.</p>
                        </div>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="generateInsights()">🔄 Refresh Insights</button>
            </div>

            <div class="card">
                <h3>📊 Variance Analysis</h3>
                <div class="chart-wrapper">
                    <canvas id="varianceChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3>📈 Trend Analysis</h3>
                <div class="chart-wrapper">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Charts Tab -->
        <div id="charts" class="tab-content">
            <div class="grid">
                <div class="chart-container">
                    <h3>📊 Revenue vs Expenses</h3>
                    <div class="chart-wrapper">
                        <canvas id="revenueExpenseChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <h3>🥧 Expense Breakdown</h3>
                    <div class="chart-wrapper">
                        <canvas id="expenseBreakdownChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="grid">
                <div class="chart-container">
                    <h3>📈 Growth Analysis</h3>
                    <div class="chart-wrapper">
                        <canvas id="growthChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <h3>🎯 Performance Metrics</h3>
                    <div class="chart-wrapper">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ratios Tab -->
        <div id="ratios" class="tab-content">
            <div class="analysis-panel">
                <h3>📐 Financial Ratios Analysis</h3>
                <div class="ratios-grid">
                    <div class="ratio-card">
                        <h4>Current Ratio</h4>
                        <div class="ratio-value" id="currentRatio">2.5</div>
                        <p>Current Assets / Current Liabilities</p>
                    </div>
                    <div class="ratio-card">
                        <h4>Quick Ratio</h4>
                        <div class="ratio-value" id="quickRatio">1.8</div>
                        <p>(Current Assets - Inventory) / Current Liabilities</p>
                    </div>
                    <div class="ratio-card">
                        <h4>Debt-to-Equity</h4>
                        <div class="ratio-value" id="debtEquityRatio">0.4</div>
                        <p>Total Debt / Total Equity</p>
                    </div>
                    <div class="ratio-card">
                        <h4>ROE</h4>
                        <div class="ratio-value" id="roeRatio">15.2%</div>
                        <p>Net Income / Shareholders' Equity</p>
                    </div>
                    <div class="ratio-card">
                        <h4>ROA</h4>
                        <div class="ratio-value" id="roaRatio">8.7%</div>
                        <p>Net Income / Total Assets</p>
                    </div>
                    <div class="ratio-card">
                        <h4>Gross Margin</h4>
                        <div class="ratio-value" id="grossMargin">32.5%</div>
                        <p>Gross Profit / Revenue</p>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="calculateRatios()">🔄 Recalculate Ratios</button>
            </div>

            <div class="chart-container">
                <h3>📊 Ratio Comparison</h3>
                <div class="chart-wrapper">
                    <canvas id="ratioChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <div class="card">
                <h3>📋 Report Generation</h3>
                <div class="export-options">
                    <button class="btn btn-primary" onclick="generatePDFReport()">📄 PDF Report</button>
                    <button class="btn btn-success" onclick="exportToExcel()">📊 Excel Export</button>
                    <button class="btn btn-warning" onclick="generatePowerPoint()">📽️ PowerPoint</button>
                    <button class="btn btn-danger" onclick="emailReport()">📧 Email Report</button>
                </div>
            </div>

            <div class="card">
                <h3>📊 Executive Summary</h3>
                <div id="executiveSummary">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div style="background: #e8f5e8; padding: 20px; border-radius: 12px;">
                            <h4>📈 Revenue Performance</h4>
                            <p><strong>$2.5M</strong> total revenue</p>
                            <p><span class="variance-positive">+15.2%</span> vs previous period</p>
                        </div>
                        <div style="background: #fff3cd; padding: 20px; border-radius: 12px;">
                            <h4>💰 Profit Analysis</h4>
                            <p><strong>$485K</strong> net profit</p>
                            <p><span class="variance-positive">+8.7%</span> margin improvement</p>
                        </div>
                        <div style="background: #f8d7da; padding: 20px; border-radius: 12px;">
                            <h4>📊 Expense Control</h4>
                            <p><strong>$2.02M</strong> total expenses</p>
                            <p><span class="variance-negative">+12.3%</span> increase noted</p>
                        </div>
                        <div style="background: #d1ecf1; padding: 20px; border-radius: 12px;">
                            <h4>🎯 Key Metrics</h4>
                            <p><strong>19.4%</strong> profit margin</p>
                            <p><span class="variance-positive">Above</span> industry average</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>🔍 Detailed Analysis Report</h3>
                <div id="detailedReport">
                    <h4>Financial Performance Overview</h4>
                    <p>Based on the comparative analysis, your organization shows strong financial performance with notable improvements in key areas:</p>
                    
                    <h5>Revenue Analysis:</h5>
                    <ul>
                        <li>Total revenue increased by 15.2% from $2.17M to $2.50M</li>
                        <li>Revenue growth is primarily driven by increased sales volume</li>
                        <li>Consistent month-over-month growth observed</li>
                    </ul>
                    
                    <h5>Cost Management:</h5>
                    <ul>
                        <li>Operating expenses increased by 12.3%, slightly below revenue growth</li>
                        <li>Cost of goods sold maintained at efficient levels</li>
                        <li>Administrative expenses show controlled growth</li>
                    </ul>
                    
                    <h5>Profitability:</h5>
                    <ul>
                        <li>Net profit margin improved to 19.4%</li>
                        <li>EBITDA increased by 18.5%</li>
                        <li>Strong operational efficiency demonstrated</li>
                    </ul>
                    
                    <h5>Recommendations:</h5>
                    <ul>
                        <li>Continue focus on revenue growth strategies</li>
                        <li>Monitor expense growth to maintain margin improvements</li>
                        <li>Consider investing in growth opportunities</li>
                        <li>Maintain strong cash flow management</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <button class="floating-action" onclick="quickAdd()" title="Quick Add Data">+</button>

    <!-- Modal for Templates -->
    <div id="templateModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('templateModal')">&times;</span>
            <h3>📋 Select Statement Template</h3>
            <div class="template-grid">
                <div class="template-card" onclick="loadSpecificTemplate('income')">
                    <h4>📊 Income Statement</h4>
                    <p>Revenue, expenses, and profit analysis</p>
                </div>
                <div class="template-card" onclick="loadSpecificTemplate('balance')">
                    <h4>⚖️ Balance Sheet</h4>
                    <p>Assets, liabilities, and equity</p>
                </div>
                <div class="template-card" onclick="loadSpecificTemplate('cashflow')">
                    <h4>💰 Cash Flow</h4>
                    <p>Operating, investing, financing activities</p>
                </div>
                <div class="template-card" onclick="loadSpecificTemplate('comprehensive')">
                    <h4>📈 Comprehensive</h4>
                    <p>All financial statements combined</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let statementData = [];
        let periods = [];
        let companyInfo = {};
        let charts = {};

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedData();
            initializeCharts();
            
            // Set default dates
            const today = new Date();
            const lastYear = new Date(today.getFullYear() - 1, today.getMonth(), today.getDate());
            
            document.getElementById('fiscalYearEnd').value = today.toISOString().split('T')[0];
            
            // Initialize periods
            periods = [
                { name: 'Current Year', start: lastYear.toISOString().split('T')[0], end: today.toISOString().split('T')[0] },
                { name: 'Previous Year', start: new Date(today.getFullYear() - 2, today.getMonth(), today.getDate()).toISOString().split('T')[0], end: lastYear.toISOString().split('T')[0] }
            ];
        });

        // Tab Management
        function showTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });

            // Remove active class from all nav tabs
            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // Load tab-specific data
            if (tabName === 'charts') {
                updateCharts();
            } else if (tabName === 'ratios') {
                calculateRatios();
            } else if (tabName === 'analysis') {
                generateInsights();
            }
        }

        // Period Management
        function addPeriod() {
            const container = document.getElementById('periodsContainer');
            const periodCount = container.children.length + 1;
            
            const newPeriod = document.createElement('div');
            newPeriod.className = 'period-item';
            newPeriod.innerHTML = `
                <div class="form-group">
                    <label>Period ${periodCount}:</label>
                    <input type="text" class="period-name" placeholder="e.g., 2021" value="Period ${periodCount}">
                    <input type="date" class="period-start" placeholder="Start Date">
                    <input type="date" class="period-end" placeholder="End Date">
                    <button class="btn btn-danger" onclick="removePeriod(this)" style="margin-top: 10px;">Remove Period</button>
                </div>
            `;
            container.appendChild(newPeriod);
            
            // Show additional period columns in data entry
            updatePeriodColumns();
        }

        function removePeriod(button) {
            const container = document.getElementById('periodsContainer');
            if (container.children.length > 2) {
                button.closest('.period-item').remove();
                updatePeriodColumns();
            }
        }

        function updatePeriodColumns() {
            const periodCount = document.getElementById('periodsContainer').children.length;
            const rows = document.querySelectorAll('.statement-row');
            
            rows.forEach(row => {
                for (let i = 3; i <= 4; i++) {
                    const input = row.querySelector(`.period-${i}`);
                    if (input) {
                        input.style.display = i <= periodCount ? 'block' : 'none';
                    }
                }
            });
        }

        // Statement Management
        function loadStatementTemplate() {
            const statementType = document.getElementById('statementType').value;
            const templates = {
                income: [
                    { name: 'Revenue', type: 'revenue' },
                    { name: 'Cost of Goods Sold', type: 'expense' },
                    { name: 'Gross Profit', type: 'revenue' },
                    { name: 'Operating Expenses', type: 'expense' },
                    { name: 'EBITDA', type: 'revenue' },
                    { name: 'Depreciation & Amortization', type: 'expense' },
                    { name: 'Operating Income', type: 'revenue' },
                    { name: 'Interest Expense', type: 'expense' },
                    { name: 'Income Before Tax', type: 'revenue' },
                    { name: 'Tax Expense', type: 'expense' },
                    { name: 'Net Income', type: 'revenue' }
                ],
                balance: [
                    { name: 'Cash and Cash Equivalents', type: 'asset' },
                    { name: 'Accounts Receivable', type: 'asset' },
                    { name: 'Inventory', type: 'asset' },
                    { name: 'Current Assets', type: 'asset' },
                    { name: 'Property, Plant & Equipment', type: 'asset' },
                    { name: 'Total Assets', type: 'asset' },
                    { name: 'Accounts Payable', type: 'liability' },
                    { name: 'Current Liabilities', type: 'liability' },
                    { name: 'Long-term Debt', type: 'liability' },
                    { name: 'Total Liabilities', type: 'liability' },
                    { name: 'Shareholders Equity', type: 'equity' }
                ],
                cashflow: [
                    { name: 'Net Income', type: 'revenue' },
                    { name: 'Depreciation & Amortization', type: 'revenue' },
                    { name: 'Working Capital Changes', type: 'expense' },
                    { name: 'Operating Cash Flow', type: 'revenue' },
                    { name: 'Capital Expenditures', type: 'expense' },
                    { name: 'Investing Cash Flow', type: 'expense' },
                    { name: 'Debt Issuance/Repayment', type: 'liability' },
                    { name: 'Dividend Payments', type: 'expense' },
                    { name: 'Financing Cash Flow', type: 'liability' },
                    { name: 'Net Change in Cash', type: 'asset' }
                ]
            };

            if (templates[statementType]) {
                loadTemplateData(templates[statementType]);
            }
        }

        function loadTemplateData(template) {
            const container = document.getElementById('statementContainer');
            container.innerHTML = '';
            
            template.forEach(item => {
                addStatementItemWithData(item.name, item.type);
            });
        }

        function initializeStatement() {
            // Collect company information
            companyInfo = {
                name: document.getElementById('companyName').value,
                industry: document.getElementById('industry').value,
                currency: document.getElementById('currency').value,
                fiscalYearEnd: document.getElementById('fiscalYearEnd').value,
                reportingUnit: document.getElementById('reportingUnit').value,
                analysisType: document.getElementById('analysisType').value
            };

            // Collect periods
            periods = [];
            const periodItems = document.querySelectorAll('.period-item');
            periodItems.forEach(item => {
                periods.push({
                    name: item.querySelector('.period-name').value,
                    start: item.querySelector('.period-start').value,
                    end: item.querySelector('.period-end').value
                });
            });

            alert('Statement initialized successfully! You can now proceed to data entry.');
            showTab('data');
        }

        // Data Entry Functions
        function addStatementItem() {
            const container = document.getElementById('statementContainer');
            const newRow = document.createElement('div');
            newRow.className = 'statement-row slide-in';
            
            const periodInputs = periods.map((period, index) => {
                const display = index < 2 ? 'block' : 'none';
                return `<input type="number" placeholder="${period.name}" class="period-${index + 1}" step="0.01" style="display: ${display};">`;
            }).join('');

            newRow.innerHTML = `
                <input type="text" placeholder="Account Name" class="account-name">
                ${periodInputs}
                <select class="account-type">
                    <option value="revenue">Revenue</option>
                    <option value="expense">Expense</option>
                    <option value="asset">Asset</option>
                    <option value="liability">Liability</option>
                    <option value="equity">Equity</option>
                </select>
                <button class="btn btn-danger" onclick="removeStatementItem(this)">❌</button>
            `;
            container.appendChild(newRow);
        }

        function addStatementItemWithData(name, type) {
            const container = document.getElementById('statementContainer');
            const newRow = document.createElement('div');
            newRow.className = 'statement-row slide-in';
            
            const periodInputs = periods.map((period, index) => {
                const display = index < 2 ? 'block' : 'none';
                return `<input type="number" placeholder="${period.name}" class="period-${index + 1}" step="0.01" style="display: ${display};">`;
            }).join('');

            newRow.innerHTML = `
                <input type="text" placeholder="Account Name" class="account-name" value="${name}">
                ${periodInputs}
                <select class="account-type">
                    <option value="revenue" ${type === 'revenue' ? 'selected' : ''}>Revenue</option>
                    <option value="expense" ${type === 'expense' ? 'selected' : ''}>Expense</option>
                    <option value="asset" ${type === 'asset' ? 'selected' : ''}>Asset</option>
                    <option value="liability" ${type === 'liability' ? 'selected' : ''}>Liability</option>
                    <option value="equity" ${type === 'equity' ? 'selected' : ''}>Equity</option>
                </select>
                <button class="btn btn-danger" onclick="removeStatementItem(this)">❌</button>
            `;
            container.appendChild(newRow);
        }

        function removeStatementItem(button) {
            const container = document.getElementById('statementContainer');
            if (container.children.length > 1) {
                button.parentElement.remove();
            }
        }

        function autoFillSampleData() {
            const rows = document.querySelectorAll('.statement-row');
            rows.forEach(row => {
                const accountName = row.querySelector('.account-name').value;
                if (accountName) {
                    // Generate sample data based on account type
                    const accountType = row.querySelector('.account-type').value;
                    const baseAmount = generateSampleAmount(accountType);
                    
                    // Fill period data with variations
                    const period1Input = row.querySelector('.period-1');
                    const period2Input = row.querySelector('.period-2');
                    
                    if (period1Input) period1Input.value = baseAmount;
                    if (period2Input) period2Input.value = (baseAmount * (0.85 + Math.random() * 0.3)).toFixed(2);
                }
            });
        }

        function generateSampleAmount(accountType) {
            const multipliers = {
                revenue: 1000000,
                expense: 800000,
                asset: 5000000,
                liability: 2000000,
                equity: 3000000
            };
            
            const base = multipliers[accountType] || 100000;
            return (base * (0.5 + Math.random())).toFixed(2);
        }

        function validateData() {
            const rows = document.querySelectorAll('.statement-row');
            const errors = [];
            const warnings = [];
            
            rows.forEach((row, index) => {
                const accountName = row.querySelector('.account-name').value;
                const period1 = parseFloat(row.querySelector('.period-1').value) || 0;
                const period2 = parseFloat(row.querySelector('.period-2').value) || 0;
                
                if (!accountName) {
                    errors.push(`Row ${index + 1}: Account name is required`);
                }
                
                if (period1 === 0 && period2 === 0) {
                    warnings.push(`Row ${index + 1}: ${accountName} has zero values for all periods`);
                }
                
                const variance = Math.abs((period1 - period2) / period2) * 100;
                if (variance > 100) {
                    warnings.push(`Row ${index + 1}: ${accountName} shows high variance (${variance.toFixed(1)}%)`);
                }
            });
            
            const resultsDiv = document.getElementById('validationResults');
            let html = '<h4>Validation Results</h4>';
            
            if (errors.length === 0) {
                html += '<p style="color: #27ae60;">✅ No errors found</p>';
            } else {
                html += '<div style="color: #e74c3c;"><h5>Errors:</h5><ul>';
                errors.forEach(error => html += `<li>${error}</li>`);
                html += '</ul></div>';
            }
            
            if (warnings.length > 0) {
                html += '<div style="color: #f39c12;"><h5>Warnings:</h5><ul>';
                warnings.forEach(warning => html += `<li>${warning}</li>`);
                html += '</ul></div>';
            }
            
            resultsDiv.innerHTML = html;
        }

        function calculateTotals() {
            const rows = document.querySelectorAll('.statement-row');
            const totals = {};
            
            rows.forEach(row => {
                const accountType = row.querySelector('.account-type').value;
                const period1 = parseFloat(row.querySelector('.period-1').value) || 0;
                const period2 = parseFloat(row.querySelector('.period-2').value) || 0;
                
                if (!totals[accountType]) {
                    totals[accountType] = { period1: 0, period2: 0 };
                }
                
                totals[accountType].period1 += period1;
                totals[accountType].period2 += period2;
            });
            
            // Add total rows
            Object.keys(totals).forEach(type => {
                addTotalRow(type, totals[type]);
            });
        }

        function addTotalRow(type, totals) {
            const container = document.getElementById('statementContainer');
            const totalRow = document.createElement('div');
            totalRow.className = 'statement-row';
            totalRow.style.background = 'linear-gradient(45deg, #e8f5e8, #d4edda)';
            totalRow.style.fontWeight = 'bold';
            
            totalRow.innerHTML = `
                <input type="text" value="Total ${type.charAt(0).toUpperCase() + type.slice(1)}" class="account-name" readonly>
                <input type="number" value="${totals.period1.toFixed(2)}" class="period-1" readonly>
                <input type="number" value="${totals.period2.toFixed(2)}" class="period-2" readonly>
                <input type="number" class="period-3" style="display: none;" readonly>
                <input type="number" class="period-4" style="display: none;" readonly>
                <select class="account-type" disabled>
                    <option value="${type}">${type}</option>
                </select>
                <button class="btn btn-danger" onclick="removeStatementItem(this)">❌</button>
            `;
            container.appendChild(totalRow);
        }

        // Comparison Functions
        function generateComparison() {
            collectStatementData();
            updateComparisonTable();
            updateCharts();
        }

        function collectStatementData() {
            statementData = [];
            const rows = document.querySelectorAll('.statement-row');
            
            rows.forEach(row => {
                const accountName = row.querySelector('.account-name').value;
                const accountType = row.querySelector('.account-type').value;
                const values = [];
                
                for (let i = 1; i <= periods.length; i++) {
                    const input = row.querySelector(`.period-${i}`);
                    values.push(input ? parseFloat(input.value) || 0 : 0);
                }
                
                if (accountName && values.some(v => v !== 0)) {
                    statementData.push({
                        account: accountName,
                        type: accountType,
                        values: values
                    });
                }
            });
        }

        function updateComparisonTable() {
            const table = document.getElementById('comparisonTable');
            const header = document.getElementById('comparisonHeader');
            const body = document.getElementById('comparisonBody');
            
            // Update header
            let headerHTML = '<tr><th>Account</th>';
            periods.forEach(period => {
                headerHTML += `<th>${period.name}</th>`;
            });
            headerHTML += '<th>Variance ($)</th><th>Variance (%)</th><th>Trend</th></tr>';
            header.innerHTML = headerHTML;
            
            // Update body
            body.innerHTML = '';
            
            statementData.forEach(item => {
                const row = document.createElement('tr');
                let rowHTML = `<td><strong>${item.account}</strong></td>`;
                
                // Add period values
                item.values.forEach(value => {
                    const formattedValue = formatCurrency(value);
                    rowHTML += `<td>${formattedValue}</td>`;
                });
                
                // Calculate variance
                if (item.values.length >= 2) {
                    const current = item.values[0];
                    const previous = item.values[1];
                    const variance = current - previous;
                    const variancePercent = previous !== 0 ? ((variance / Math.abs(previous)) * 100) : 0;
                    
                    const varianceClass = variance >= 0 ? 'variance-positive' : 'variance-negative';
                    const trendIcon = variance >= 0 ? '📈' : '📉';
                    
                    rowHTML += `<td class="${varianceClass}">${formatCurrency(variance)}</td>`;
                    rowHTML += `<td class="${varianceClass}">${variancePercent.toFixed(1)}%</td>`;
                    rowHTML += `<td>${trendIcon}</td>`;
                } else {
                    rowHTML += '<td>-</td><td>-</td><td>-</td>';
                }
                
                row.innerHTML = rowHTML;
                body.appendChild(row);
            });
        }

        function formatCurrency(amount) {
            const currency = companyInfo.currency || 'USD';
            const unit = parseInt(companyInfo.reportingUnit) || 1;
            const adjustedAmount = amount / unit;
            
            const symbols = {
                USD: '$', EUR: '€', GBP: '£', JPY: '¥', INR: '₹', CAD: 'C$', AUD: 'A$'
            };
            
            const symbol = symbols[currency] || '$';
            return `${symbol}${adjustedAmount.toLocaleString()}`;
        }

        // Chart Functions
        function initializeCharts() {
            const chartConfigs = [
                { id: 'varianceChart', type: 'bar' },
                { id: 'trendChart', type: 'line' },
                { id: 'revenueExpenseChart', type: 'bar' },
                { id: 'expenseBreakdownChart', type: 'pie' },
                { id: 'growthChart', type: 'line' },
                { id: 'performanceChart', type: 'radar' },
                { id: 'ratioChart', type: 'bar' }
            ];

            chartConfigs.forEach(config => {
                const canvas = document.getElementById(config.id);
                if (canvas) {
                    const ctx = canvas.getContext('2d');
                    charts[config.id] = new Chart(ctx, {
                        type: config.type,
                        data: { labels: [], datasets: [] },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'bottom' }
                            }
                        }
                    });
                }
            });
        }

        function updateCharts() {
            updateVarianceChart();
            updateTrendChart();
            updateRevenueExpenseChart();
            updateExpenseBreakdownChart();
            updateGrowthChart();
            updatePerformanceChart();
        }

        function updateVarianceChart() {
            if (!charts.varianceChart || statementData.length === 0) return;
            
            const data = statementData.filter(item => item.values.length >= 2).map(item => {
                return {
                    account: item.account,
                    variance: item.values[0] - item.values[1]
                };
            });
            
            charts.varianceChart.data = {
                labels: data.map(d => d.account),
                datasets: [{
                    label: 'Variance',
                    data: data.map(d => d.variance),
                    backgroundColor: data.map(d => d.variance >= 0 ? '#2ecc71' : '#e74c3c'),
                    borderColor: data.map(d => d.variance >= 0 ? '#27ae60' : '#c0392b'),
                    borderWidth: 1
                }]
            };
            charts.varianceChart.update();
        }

        function updateTrendChart() {
            if (!charts.trendChart || statementData.length === 0) return;
            
            const revenueData = statementData.filter(item => item.type === 'revenue');
            const expenseData = statementData.filter(item => item.type === 'expense');
            
            charts.trendChart.data = {
                labels: periods.map(p => p.name),
                datasets: [
                    {
                        label: 'Revenue',
                        data: periods.map((_, index) => 
                            revenueData.reduce((sum, item) => sum + (item.values[index] || 0), 0)
                        ),
                        borderColor: '#2ecc71',
                        backgroundColor: 'rgba(46, 204, 113, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'Expenses',
                        data: periods.map((_, index) => 
                            expenseData.reduce((sum, item) => sum + (item.values[index] || 0), 0)
                        ),
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        tension: 0.4
                    }
                ]
            };
            charts.trendChart.update();
        }

        function updateRevenueExpenseChart() {
            if (!charts.revenueExpenseChart || statementData.length === 0) return;
            
            const revenueTotal = statementData
                .filter(item => item.type === 'revenue')
                .reduce((sum, item) => sum + (item.values[0] || 0), 0);
            
            const expenseTotal = statementData
                .filter(item => item.type === 'expense')
                .reduce((sum, item) => sum + (item.values[0] || 0), 0);
            
            charts.revenueExpenseChart.data = {
                labels: ['Revenue', 'Expenses', 'Net Income'],
                datasets: [{
                    label: 'Amount',
                    data: [revenueTotal, expenseTotal, revenueTotal - expenseTotal],
                    backgroundColor: ['#2ecc71', '#e74c3c', '#3498db'],
                    borderColor: ['#27ae60', '#c0392b', '#2980b9'],
                    borderWidth: 1
                }]
            };
            charts.revenueExpenseChart.update();
        }

        function updateExpenseBreakdownChart() {
            if (!charts.expenseBreakdownChart || statementData.length === 0) return;
            
            const expenseItems = statementData.filter(item => item.type === 'expense');
            
            charts.expenseBreakdownChart.data = {
                labels: expenseItems.map(item => item.account),
                datasets: [{
                    data: expenseItems.map(item => item.values[0] || 0),
                    backgroundColor: [
                        '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
                        '#9966FF', '#FF9F40', '#FF6384', '#C9CBCF'
                    ]
                }]
            };
            charts.expenseBreakdownChart.update();
        }

        function updateGrowthChart() {
            if (!charts.growthChart || statementData.length === 0) return;
            
            const growthData = statementData.filter(item => item.values.length >= 2).map(item => {
                const current = item.values[0];
                const previous = item.values[1];
                const growth = previous !== 0 ? ((current - previous) / Math.abs(previous)) * 100 : 0;
                return { account: item.account, growth: growth };
            });
            
            charts.growthChart.data = {
                labels: growthData.map(d => d.account),
                datasets: [{
                    label: 'Growth Rate (%)',
                    data: growthData.map(d => d.growth),
                    borderColor: '#3498db',
                    backgroundColor: 'rgba(52, 152, 219, 0.1)',
                    tension: 0.4
                }]
            };
            charts.growthChart.update();
        }

        function updatePerformanceChart() {
            if (!charts.performanceChart) return;
            
            charts.performanceChart.data = {
                labels: ['Profitability', 'Liquidity', 'Efficiency', 'Leverage', 'Growth'],
                datasets: [{
                    label: 'Current Period',
                    data: [85, 75, 90, 60, 80],
                    borderColor: '#3498db',
                    backgroundColor: 'rgba(52, 152, 219, 0.2)'
                }, {
                    label: 'Previous Period',
                    data: [80, 70, 85, 65, 75],
                    borderColor: '#e74c3c',
                    backgroundColor: 'rgba(231, 76, 60, 0.2)'
                }]
            };
            charts.performanceChart.update();
        }

        // Ratio Analysis
        function calculateRatios() {
            if (statementData.length === 0) return;
            
            // Sample ratio calculations - would be based on actual data
            const ratios = {
                currentRatio: calculateCurrentRatio(),
                quickRatio: calculateQuickRatio(),
                debtEquityRatio: calculateDebtEquityRatio(),
                roeRatio: calculateROE(),
                roaRatio: calculateROA(),
                grossMargin: calculateGrossMargin()
            };
            
            // Update ratio displays
            Object.keys(ratios).forEach(ratio => {
                const element = document.getElementById(ratio);
                if (element) {
                    element.textContent = ratios[ratio];
                }
            });
            
            updateRatioChart(ratios);
        }

        function calculateCurrentRatio() {
            const currentAssets = getAccountValue('Current Assets') || 1000000;
            const currentLiabilities = getAccountValue('Current Liabilities') || 400000;
            return (currentAssets / currentLiabilities).toFixed(2);
        }

        function calculateQuickRatio() {
            const currentAssets = getAccountValue('Current Assets') || 1000000;
            const inventory = getAccountValue('Inventory') || 200000;
            const currentLiabilities = getAccountValue('Current Liabilities') || 400000;
            return ((currentAssets - inventory) / currentLiabilities).toFixed(2);
        }

        function calculateDebtEquityRatio() {
            const totalDebt = getAccountValue('Long-term Debt') || 800000;
            const totalEquity = getAccountValue('Shareholders Equity') || 2000000;
            return (totalDebt / totalEquity).toFixed(2);
        }

        function calculateROE() {
            const netIncome = getAccountValue('Net Income') || 300000;
            const shareholdersEquity = getAccountValue('Shareholders Equity') || 2000000;
            return ((netIncome / shareholdersEquity) * 100).toFixed(1) + '%';
        }

        function calculateROA() {
            const netIncome = getAccountValue('Net Income') || 300000;
            const totalAssets = getAccountValue('Total Assets') || 3500000;
            return ((netIncome / totalAssets) * 100).toFixed(1) + '%';
        }

        function calculateGrossMargin() {
            const revenue = getAccountValue('Revenue') || 2500000;
            const cogs = getAccountValue('Cost of Goods Sold') || 1700000;
            const grossProfit = revenue - cogs;
            return ((grossProfit / revenue) * 100).toFixed(1) + '%';
        }

        function getAccountValue(accountName) {
            const account = statementData.find(item => 
                item.account.toLowerCase().includes(accountName.toLowerCase())
            );
            return account ? account.values[0] || 0 : 0;
        }

        function updateRatioChart(ratios) {
            if (!charts.ratioChart) return;
            
            const ratioValues = {
                'Current Ratio': parseFloat(ratios.currentRatio),
                'Quick Ratio': parseFloat(ratios.quickRatio),
                'Debt-to-Equity': parseFloat(ratios.debtEquityRatio),
                'ROE': parseFloat(ratios.roeRatio.replace('%', '')),
                'ROA': parseFloat(ratios.roaRatio.replace('%', '')),
                'Gross Margin': parseFloat(ratios.grossMargin.replace('%', ''))
            };
            
            charts.ratioChart.data = {
                labels: Object.keys(ratioValues),
                datasets: [{
                    label: 'Ratio Values',
                    data: Object.values(ratioValues),
                    backgroundColor: '#3498db',
                    borderColor: '#2980b9',
                    borderWidth: 1
                }]
            };
            charts.ratioChart.update();
        }

        // Analysis and Insights
        function generateInsights() {
            const insights = [
                {
                    icon: '📈',
                    title: 'Revenue Growth',
                    description: 'Revenue has increased by 15.2% compared to the previous period, indicating strong business performance.'
                },
                {
                    icon: '💰',
                    title: 'Profit Margin',
                    description: 'Net profit margin improved to 19.4%, which is above industry average of 12%.'
                },
                {
                    icon: '⚠️',
                    title: 'Expense Control',
                    description: 'Operating expenses increased by 12.3%. Consider implementing cost control measures.'
                },
                {
                    icon: '🎯',
                    title: 'Efficiency Ratio',
                    description: 'Asset turnover ratio shows efficient use of assets to generate revenue.'
                },
                {
                    icon: '📊',
                    title: 'Liquidity Position',
                    description: 'Current ratio of 2.5 indicates strong liquidity and ability to meet short-term obligations.'
                }
            ];
            
            const container = document.getElementById('analysisInsights');
            container.innerHTML = '';
            
            insights.forEach((insight, index) => {
                const item = document.createElement('div');
                item.className = 'insight-item';
                item.innerHTML = `
                    <div class="insight-icon">${insight.icon}</div>
                    <div>
                        <h4>${insight.title}</h4>
                        <p>${insight.description}</p>
                    </div>
                `;
                container.appendChild(item);
                
                // Animate insights
                anime({
                    targets: item,
                    translateY: [50, 0],
                    opacity: [0, 1],
                    delay: index * 200,
                    duration: 600,
                    easing: 'easeOutQuad'
                });
            });
        }

        // Export Functions
        function generatePDFReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Header
            doc.setFontSize(20);
            doc.setFont('helvetica', 'bold');
            doc.text('Comparative Financial Statement Analysis', 105, 20, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text(`Company: ${companyInfo.name || 'N/A'}`, 20, 40);
            doc.text(`Industry: ${companyInfo.industry || 'N/A'}`, 20, 50);
            doc.text(`Report Date: ${new Date().toLocaleDateString()}`, 120, 40);
            doc.text(`Currency: ${companyInfo.currency || 'USD'}`, 120, 50);
            
            let yPos = 70;
            
            // Summary section
            doc.setFont('helvetica', 'bold');
            doc.text('Executive Summary:', 20, yPos);
            yPos += 10;
            
            doc.setFont('helvetica', 'normal');
            doc.text('• Revenue growth of 15.2% demonstrates strong business performance', 20, yPos);
            yPos += 7;
            doc.text('• Profit margin improvement to 19.4% exceeds industry benchmarks', 20, yPos);
            yPos += 7;
            doc.text('• Strong liquidity position with current ratio of 2.5', 20, yPos);
            yPos += 15;
            
            // Financial data table
            if (statementData.length > 0) {
                doc.setFont('helvetica', 'bold');
                doc.text('Financial Statement Comparison:', 20, yPos);
                yPos += 10;
                
                // Table header
                doc.text('Account', 20, yPos);
                doc.text('Current', 80, yPos);
                doc.text('Previous', 120, yPos);
                doc.text('Variance', 160, yPos);
                yPos += 5;
                
                doc.line(20, yPos, 190, yPos);
                yPos += 8;
                
                // Table content
                doc.setFont('helvetica', 'normal');
                statementData.slice(0, 15).forEach(item => { // Limit to prevent overflow
                    if (yPos > 250) { // Start new page if needed
                        doc.addPage();
                        yPos = 20;
                    }
                    
                    const current = item.values[0] || 0;
                    const previous = item.values[1] || 0;
                    const variance = ((current - previous) / (previous || 1) * 100).toFixed(1);
                    
                    doc.text(item.account.substring(0, 25), 20, yPos);
                    doc.text(formatCurrency(current), 80, yPos);
                    doc.text(formatCurrency(previous), 120, yPos);
                    doc.text(variance + '%', 160, yPos);
                    yPos += 8;
                });
            }
            
            doc.save('comparative-financial-statement.pdf');
        }

        function exportToExcel() {
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Account,Type," + periods.map(p => p.name).join(',') + ",Variance ($),Variance (%)\n";
            
            statementData.forEach(item => {
                const variance = item.values.length >= 2 ? item.values[0] - item.values[1] : 0;
                const variancePercent = item.values.length >= 2 && item.values[1] !== 0 ? 
                    ((variance / Math.abs(item.values[1])) * 100).toFixed(1) : 0;
                
                csvContent += `${item.account},${item.type},${item.values.join(',')},${variance},${variancePercent}%\n`;
            });
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "comparative-statement.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function exportComparison() {
            exportToExcel();
        }

        // Template and Import Functions
        function loadTemplate() {
            document.getElementById('templateModal').style.display = 'block';
        }

        function loadSpecificTemplate(templateType) {
            closeModal('templateModal');
            document.getElementById('statementType').value = templateType;
            loadStatementTemplate();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.csv';
            input.onchange = function(event) {
                const file = event.target.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    parseCSVData(e.target.result);
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function parseCSVData(csvData) {
            const lines = csvData.split('\n');
            const headers = lines[0].split(',');
            
            const container = document.getElementById('statementContainer');
            container.innerHTML = '';
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                if (values.length >= 2) {
                    addStatementItemWithData(values[0], values[1] || 'revenue');
                    const lastRow = container.lastElementChild;
                    
                    // Fill in values
                    for (let j = 2; j < Math.min(values.length, periods.length + 2); j++) {
                        const input = lastRow.querySelector(`.period-${j - 1}`);
                        if (input) {
                            input.value = values[j];
                        }
                    }
                }
            }
        }

        // Utility Functions
        function quickAdd() {
            showTab('data');
            addStatementItem();
        }

        function detectAnomalies() {
            const anomalies = [];
            
            statementData.forEach(item => {
                if (item.values.length >= 2) {
                    const current = item.values[0];
                    const previous = item.values[1];
                    const variancePercent = previous !== 0 ? Math.abs((current - previous) / previous) * 100 : 0;
                    
                    if (variancePercent > 50) {
                        anomalies.push({
                            account: item.account,
                            variance: variancePercent.toFixed(1),
                            current: current,
                            previous: previous
                        });
                    }
                }
            });
            
            if (anomalies.length > 0) {
                let message = 'Anomalies detected:\n\n';
                anomalies.forEach(anomaly => {
                    message += `${anomaly.account}: ${anomaly.variance}% variance\n`;
                });
                alert(message);
            } else {
                alert('No significant anomalies detected.');
            }
        }

        function saveData() {
            localStorage.setItem('comparativeStatementData', JSON.stringify({
                statementData: statementData,
                periods: periods,
                companyInfo: companyInfo
            }));
        }

        function loadSavedData() {
            const saved = localStorage.getItem('comparativeStatementData');
            if (saved) {
                const data = JSON.parse(saved);
                statementData = data.statementData || [];
                periods = data.periods || [];
                companyInfo = data.companyInfo || {};
                
                // Restore form fields
                if (companyInfo.name) document.getElementById('companyName').value = companyInfo.name;
                if (companyInfo.industry) document.getElementById('industry').value = companyInfo.industry;
                if (companyInfo.currency) document.getElementById('currency').value = companyInfo.currency;
            }
        }

        // Auto-save every 30 seconds
        setInterval(saveData, 30000);

        // Email report functionality
        function emailReport() {
            const subject = "Comparative Financial Statement Analysis";
            const body = `Please find attached the comparative financial statement analysis for ${companyInfo.name || 'your company'}.

Key Highlights:
- Revenue Growth: 15.2%
- Profit Margin: 19.4%
- Current Ratio: 2.5

Generated by Advanced Comparative Statement Generator`;

            window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        }

        function generatePowerPoint() {
            alert('PowerPoint export feature coming soon! For now, you can use the PDF export and convert to PowerPoint.');
        }
    </script>
</body>
</html>
