
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Company Management System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #3498db;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            --card-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--gradient);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }

        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .auth-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 40px;
            box-shadow: var(--card-shadow);
            width: 100%;
            max-width: 400px;
            position: relative;
            overflow: hidden;
        }

        .auth-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(45deg, var(--primary), var(--secondary), #f093fb);
            border-radius: 20px 20px 0 0;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-header h1 {
            font-size: 2.5em;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 5px;
        }

        .auth-tab {
            flex: 1;
            padding: 10px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }

        .auth-tab.active {
            background: var(--primary);
            color: white;
        }

        .app-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .app-header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            color: white;
            box-shadow: var(--card-shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .app-header h1 {
            font-size: 2.5em;
            background: linear-gradient(45deg, #fff, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 15px 25px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            color: white;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .nav-tab:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            background: rgba(255, 255, 255, 0.2);
        }

        .nav-tab.active {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.15);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(45deg, var(--primary), var(--secondary), #f093fb);
            border-radius: 20px 20px 0 0;
        }

        .card h3 {
            color: var(--dark);
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
            font-size: 14px;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 16px;
            transition: var(--transition);
            background: rgba(255, 255, 255, 0.9);
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            margin: 5px;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, var(--success), #27ae60);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, var(--danger), #c0392b);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, var(--warning), #e67e22);
            color: white;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .table-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--card-shadow);
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
        }

        .data-table th, .data-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .data-table th {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .data-table tr:hover {
            background: #e3f2fd;
            transform: scale(1.01);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 90%;
            overflow-y: auto;
        }

        .close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 30px;
            cursor: pointer;
            color: #999;
        }

        .staff-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr auto auto;
            gap: 15px;
            margin-bottom: 15px;
            align-items: center;
            padding: 20px;
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            border-left: 5px solid var(--primary);
            transition: var(--transition);
        }

        .staff-row:hover {
            transform: translateX(10px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .payroll-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 15px;
            color: white;
        }

        .salary-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .salary-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--card-shadow);
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
        }

        .floating-action {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transition: var(--transition);
            z-index: 100;
        }

        .floating-action:hover {
            transform: scale(1.1) rotate(180deg);
        }

        .alert {
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
            border-left: 5px solid;
        }

        .alert-success {
            background: #d4edda;
            border-color: var(--success);
            color: #155724;
        }

        .alert-danger {
            background: #f8d7da;
            border-color: var(--danger);
            color: #721c24;
        }

        .alert-warning {
            background: #fff3cd;
            border-color: var(--warning);
            color: #856404;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            z-index: 1001;
            transform: translateX(400px);
            transition: var(--transition);
        }

        .notification.show {
            transform: translateX(0);
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            .staff-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .nav-tabs {
                flex-direction: column;
                align-items: center;
            }
            
            .app-header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .app-header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <!-- Authentication Container -->
    <div id="authContainer" class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <h1>🏢 CompanyPro</h1>
                <p>Advanced Company Management System</p>
            </div>
            
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')">Login</button>
                <button class="auth-tab" onclick="switchAuthTab('register')">Register</button>
            </div>

            <form id="loginForm" class="auth-form">
                <div class="form-group">
                    <label for="loginUsername">Username:</label>
                    <input type="text" id="loginUsername" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password:</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
            </form>

            <form id="registerForm" class="auth-form hidden">
                <div class="form-group">
                    <label for="registerFullName">Full Name:</label>
                    <input type="text" id="registerFullName" required>
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email:</label>
                    <input type="email" id="registerEmail" required>
                </div>
                <div class="form-group">
                    <label for="registerUsername">Username:</label>
                    <input type="text" id="registerUsername" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">Password:</label>
                    <input type="password" id="registerPassword" required>
                </div>
                <div class="form-group">
                    <label for="registerCompany">Company Name:</label>
                    <input type="text" id="registerCompany" required>
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%;">Register</button>
            </form>

            <div id="authMessage" class="alert hidden"></div>
        </div>
    </div>

    <!-- Main Application Container -->
    <div id="appContainer" class="app-container hidden">
        <div class="app-header">
            <div>
                <h1>🏢 CompanyPro Dashboard</h1>
                <p id="companyName">Welcome to your company management system</p>
            </div>
            <div class="user-info">
                <span id="currentUser">User</span>
                <button class="btn btn-danger" onclick="logout()">Logout</button>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalStaff">0</div>
                <div class="stat-label">Total Staff</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalPayroll">$0</div>
                <div class="stat-label">Monthly Payroll</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="activeProjects">0</div>
                <div class="stat-label">Active Projects</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="pendingTasks">0</div>
                <div class="stat-label">Pending Tasks</div>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">📊 Dashboard</button>
            <button class="nav-tab" onclick="showTab('staff')">👥 Staff Management</button>
            <button class="nav-tab" onclick="showTab('payroll')">💰 Payroll System</button>
            <button class="nav-tab" onclick="showTab('departments')">🏢 Departments</button>
            <button class="nav-tab" onclick="showTab('projects')">📋 Projects</button>
            <button class="nav-tab" onclick="showTab('reports')">📈 Reports</button>
            <button class="nav-tab" onclick="showTab('settings')">⚙️ Settings</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="grid">
                <div class="chart-container">
                    <h3>📊 Monthly Payroll Trends</h3>
                    <div class="chart-wrapper">
                        <canvas id="payrollChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <h3>👥 Staff Distribution</h3>
                    <div class="chart-wrapper">
                        <canvas id="staffChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>📋 Recent Activities</h3>
                <div id="recentActivities">
                    <p style="text-align: center; color: #999; padding: 40px;">No recent activities</p>
                </div>
            </div>
        </div>

        <!-- Staff Management Tab -->
        <div id="staff" class="tab-content">
            <div class="card">
                <h3>👥 Add New Staff Member</h3>
                <div class="staff-row">
                    <input type="text" id="staffName" placeholder="Full Name" class="form-input">
                    <input type="email" id="staffEmail" placeholder="Email" class="form-input">
                    <input type="text" id="staffPhone" placeholder="Phone" class="form-input">
                    <select id="staffDepartment" class="form-input">
                        <option value="">Select Department</option>
                        <option value="HR">Human Resources</option>
                        <option value="IT">Information Technology</option>
                        <option value="Finance">Finance</option>
                        <option value="Marketing">Marketing</option>
                        <option value="Operations">Operations</option>
                        <option value="Sales">Sales</option>
                    </select>
                    <select id="staffPosition" class="form-input">
                        <option value="">Select Position</option>
                        <option value="Manager">Manager</option>
                        <option value="Senior">Senior</option>
                        <option value="Junior">Junior</option>
                        <option value="Intern">Intern</option>
                    </select>
                    <input type="number" id="staffSalary" placeholder="Monthly Salary" class="form-input">
                    <button class="btn btn-success" onclick="addStaff()">➕ Add</button>
                </div>
                
                <div class="form-group">
                    <label>Bank Details:</label>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <input type="text" id="staffBankName" placeholder="Bank Name" class="form-input">
                        <input type="text" id="staffAccountNumber" placeholder="Account Number" class="form-input">
                        <input type="text" id="staffBankCode" placeholder="Bank Code/IBAN" class="form-input">
                    </div>
                </div>
            </div>

            <div class="table-container">
                <h3>📋 Staff Directory</h3>
                <table class="data-table" id="staffTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Department</th>
                            <th>Position</th>
                            <th>Salary</th>
                            <th>Bank Details</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="staffTableBody">
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 40px; color: #999;">
                                No staff members added yet
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Payroll System Tab -->
        <div id="payroll" class="tab-content">
            <div class="card">
                <h3>💰 Generate Payroll</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="payrollMonth">Pay Period:</label>
                        <input type="month" id="payrollMonth">
                    </div>
                    <div class="form-group">
                        <label for="payrollType">Payroll Type:</label>
                        <select id="payrollType">
                            <option value="monthly">Monthly</option>
                            <option value="weekly">Weekly</option>
                            <option value="biweekly">Bi-weekly</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="generatePayroll()">🧮 Generate Payroll</button>
                <button class="btn btn-success" onclick="exportPayroll()">📤 Export Payroll</button>
            </div>

            <div id="payrollResults" class="table-container hidden">
                <h3>💸 Payroll Summary</h3>
                <div id="payrollSummary" class="salary-breakdown"></div>
                
                <table class="data-table" id="payrollTable">
                    <thead>
                        <tr>
                            <th>Employee</th>
                            <th>Department</th>
                            <th>Base Salary</th>
                            <th>Overtime</th>
                            <th>Bonuses</th>
                            <th>Deductions</th>
                            <th>Net Pay</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="payrollTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Departments Tab -->
        <div id="departments" class="tab-content">
            <div class="card">
                <h3>🏢 Add New Department</h3>
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 15px; align-items: center;">
                    <input type="text" id="deptName" placeholder="Department Name" class="form-input">
                    <input type="text" id="deptManager" placeholder="Manager" class="form-input">
                    <input type="number" id="deptBudget" placeholder="Budget" class="form-input">
                    <button class="btn btn-success" onclick="addDepartment()">➕ Add</button>
                </div>
            </div>

            <div class="grid">
                <div id="departmentsList">
                    <!-- Departments will be populated here -->
                </div>
            </div>
        </div>

        <!-- Projects Tab -->
        <div id="projects" class="tab-content">
            <div class="card">
                <h3>📋 Add New Project</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <input type="text" id="projectName" placeholder="Project Name" class="form-input">
                    <input type="text" id="projectClient" placeholder="Client" class="form-input">
                    <input type="date" id="projectStartDate" class="form-input">
                    <input type="date" id="projectEndDate" class="form-input">
                    <select id="projectStatus" class="form-input">
                        <option value="planning">Planning</option>
                        <option value="active">Active</option>
                        <option value="completed">Completed</option>
                        <option value="onhold">On Hold</option>
                    </select>
                    <input type="number" id="projectBudget" placeholder="Budget" class="form-input">
                </div>
                <textarea id="projectDescription" placeholder="Project Description" rows="3" class="form-input"></textarea>
                <button class="btn btn-success" onclick="addProject()" style="margin-top: 15px;">➕ Add Project</button>
            </div>

            <div class="table-container">
                <h3>📋 Projects Overview</h3>
                <table class="data-table" id="projectsTable">
                    <thead>
                        <tr>
                            <th>Project Name</th>
                            <th>Client</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            <th>Status</th>
                            <th>Budget</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="projectsTableBody">
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 40px; color: #999;">
                                No projects added yet
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <div class="grid">
                <div class="card">
                    <h3>📊 Generate Reports</h3>
                    <div class="form-group">
                        <label for="reportType">Report Type:</label>
                        <select id="reportType">
                            <option value="payroll">Payroll Report</option>
                            <option value="staff">Staff Report</option>
                            <option value="department">Department Report</option>
                            <option value="project">Project Report</option>
                            <option value="financial">Financial Summary</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="reportPeriod">Period:</label>
                        <select id="reportPeriod">
                            <option value="monthly">This Month</option>
                            <option value="quarterly">This Quarter</option>
                            <option value="yearly">This Year</option>
                            <option value="custom">Custom Range</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="generateReport()">📋 Generate Report</button>
                    <button class="btn btn-success" onclick="exportReport()">📤 Export PDF</button>
                </div>

                <div class="card">
                    <h3>📈 Key Metrics</h3>
                    <div id="keyMetrics">
                        <div class="salary-breakdown">
                            <div class="salary-item">
                                <h4>💰 Total Payroll</h4>
                                <p id="metricTotalPayroll">$0</p>
                            </div>
                            <div class="salary-item">
                                <h4>👥 Employee Count</h4>
                                <p id="metricEmployeeCount">0</p>
                            </div>
                            <div class="salary-item">
                                <h4>🏢 Departments</h4>
                                <p id="metricDepartmentCount">0</p>
                            </div>
                            <div class="salary-item">
                                <h4>📋 Active Projects</h4>
                                <p id="metricActiveProjects">0</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chart-container">
                <h3>📊 Financial Overview</h3>
                <div class="chart-wrapper">
                    <canvas id="financialChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <div class="grid">
                <div class="card">
                    <h3>🏢 Company Settings</h3>
                    <div class="form-group">
                        <label for="settingsCompanyName">Company Name:</label>
                        <input type="text" id="settingsCompanyName" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="settingsCompanyAddress">Address:</label>
                        <textarea id="settingsCompanyAddress" rows="3" class="form-input"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="settingsCompanyPhone">Phone:</label>
                        <input type="text" id="settingsCompanyPhone" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="settingsCompanyEmail">Email:</label>
                        <input type="email" id="settingsCompanyEmail" class="form-input">
                    </div>
                    <button class="btn btn-primary" onclick="saveCompanySettings()">💾 Save Settings</button>
                </div>

                <div class="card">
                    <h3>⚙️ System Configuration</h3>
                    <div class="form-group">
                        <label for="settingsCurrency">Currency:</label>
                        <select id="settingsCurrency" class="form-input">
                            <option value="USD">USD ($)</option>
                            <option value="EUR">EUR (€)</option>
                            <option value="GBP">GBP (£)</option>
                            <option value="JPY">JPY (¥)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="settingsDateFormat">Date Format:</label>
                        <select id="settingsDateFormat" class="form-input">
                            <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                            <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                            <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="settingsPayrollFreq">Default Payroll Frequency:</label>
                        <select id="settingsPayrollFreq" class="form-input">
                            <option value="monthly">Monthly</option>
                            <option value="biweekly">Bi-weekly</option>
                            <option value="weekly">Weekly</option>
                        </select>
                    </div>
                    <button class="btn btn-success" onclick="saveSystemSettings()">💾 Save Configuration</button>
                </div>
            </div>

            <div class="card">
                <h3>📊 Data Management</h3>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="exportAllData()">📤 Export All Data</button>
                    <button class="btn btn-warning" onclick="importData()">📥 Import Data</button>
                    <button class="btn btn-info" onclick="backupData()">💾 Backup Data</button>
                    <button class="btn btn-danger" onclick="clearAllData()">🗑️ Clear All Data</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <button class="floating-action hidden" id="fabButton" onclick="quickAction()" title="Quick Action">+</button>

    <!-- Edit Staff Modal -->
    <div id="editStaffModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('editStaffModal')">&times;</span>
            <h3>✏️ Edit Staff Member</h3>
            <form id="editStaffForm">
                <div class="form-group">
                    <label>Full Name:</label>
                    <input type="text" id="editStaffName" required>
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="editStaffEmail" required>
                </div>
                <div class="form-group">
                    <label>Phone:</label>
                    <input type="text" id="editStaffPhone">
                </div>
                <div class="form-group">
                    <label>Department:</label>
                    <select id="editStaffDepartment">
                        <option value="HR">Human Resources</option>
                        <option value="IT">Information Technology</option>
                        <option value="Finance">Finance</option>
                        <option value="Marketing">Marketing</option>
                        <option value="Operations">Operations</option>
                        <option value="Sales">Sales</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Position:</label>
                    <select id="editStaffPosition">
                        <option value="Manager">Manager</option>
                        <option value="Senior">Senior</option>
                        <option value="Junior">Junior</option>
                        <option value="Intern">Intern</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Monthly Salary:</label>
                    <input type="number" id="editStaffSalary" required>
                </div>
                <div class="form-group">
                    <label>Bank Name:</label>
                    <input type="text" id="editStaffBankName">
                </div>
                <div class="form-group">
                    <label>Account Number:</label>
                    <input type="text" id="editStaffAccountNumber">
                </div>
                <div class="form-group">
                    <label>Bank Code/IBAN:</label>
                    <input type="text" id="editStaffBankCode">
                </div>
                <button type="submit" class="btn btn-success">💾 Update Staff</button>
            </form>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script>
        // Global Variables
        let currentUser = null;
        let users = JSON.parse(localStorage.getItem('companyUsers')) || {};
        let staffMembers = [];
        let departments = [];
        let projects = [];
        let payrollData = [];
        let companySettings = {};
        let systemSettings = {
            currency: 'USD',
            dateFormat: 'MM/DD/YYYY',
            payrollFreq: 'monthly'
        };
        let editingStaffId = null;
        let charts = {};

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthStatus();
            initializeEventListeners();
        });

        // Authentication Functions
        function switchAuthTab(tab) {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const tabs = document.querySelectorAll('.auth-tab');
            
            tabs.forEach(t => t.classList.remove('active'));
            
            if (tab === 'login') {
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
                tabs[0].classList.add('active');
            } else {
                loginForm.classList.add('hidden');
                registerForm.classList.remove('hidden');
                tabs[1].classList.add('active');
            }
        }

        function login(event) {
            event.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            if (users[username] && users[username].password === password) {
                currentUser = users[username];
                localStorage.setItem('currentCompanyUser', JSON.stringify(currentUser));
                showApp();
                showNotification('Login successful!', 'success');
            } else {
                showAuthMessage('Invalid username or password!', 'danger');
            }
        }

        function register(event) {
            event.preventDefault();
            const fullName = document.getElementById('registerFullName').value;
            const email = document.getElementById('registerEmail').value;
            const username = document.getElementById('registerUsername').value;
            const password = document.getElementById('registerPassword').value;
            const company = document.getElementById('registerCompany').value;
            
            if (users[username]) {
                showAuthMessage('Username already exists!', 'danger');
                return;
            }
            
            const newUser = {
                fullName,
                email,
                username,
                password,
                company,
                registeredAt: new Date().toISOString()
            };
            
            users[username] = newUser;
            localStorage.setItem('companyUsers', JSON.stringify(users));
            
            currentUser = newUser;
            localStorage.setItem('currentCompanyUser', JSON.stringify(currentUser));
            
            showApp();
            showNotification('Registration successful! Welcome to CompanyPro!', 'success');
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                currentUser = null;
                localStorage.removeItem('currentCompanyUser');
                showAuth();
                showNotification('Logged out successfully!', 'success');
            }
        }

        function checkAuthStatus() {
            const savedUser = localStorage.getItem('currentCompanyUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showApp();
            } else {
                showAuth();
            }
        }

        function showAuth() {
            document.getElementById('authContainer').classList.remove('hidden');
            document.getElementById('appContainer').classList.add('hidden');
            document.getElementById('fabButton').classList.add('hidden');
        }

        function showApp() {
            document.getElementById('authContainer').classList.add('hidden');
            document.getElementById('appContainer').classList.remove('hidden');
            document.getElementById('fabButton').classList.remove('hidden');
            
            document.getElementById('currentUser').textContent = currentUser.fullName;
            document.getElementById('companyName').textContent = currentUser.company;
            
            loadUserData();
            updateDashboard();
            initializeCharts();
        }

        function showAuthMessage(message, type) {
            const messageDiv = document.getElementById('authMessage');
            messageDiv.textContent = message;
            messageDiv.className = `alert alert-${type}`;
            messageDiv.classList.remove('hidden');
            
            setTimeout(() => {
                messageDiv.classList.add('hidden');
            }, 5000);
        }

        // Tab Management
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'dashboard') {
                updateDashboard();
            } else if (tabName === 'reports') {
                updateReports();
            }
        }

        // Staff Management
        function addStaff() {
            const name = document.getElementById('staffName').value;
            const email = document.getElementById('staffEmail').value;
            const phone = document.getElementById('staffPhone').value;
            const department = document.getElementById('staffDepartment').value;
            const position = document.getElementById('staffPosition').value;
            const salary = parseFloat(document.getElementById('staffSalary').value);
            const bankName = document.getElementById('staffBankName').value;
            const accountNumber = document.getElementById('staffAccountNumber').value;
            const bankCode = document.getElementById('staffBankCode').value;
            
            if (!name || !email || !department || !position || !salary) {
                showNotification('Please fill in all required fields!', 'danger');
                return;
            }
            
            const staff = {
                id: Date.now(),
                name,
                email,
                phone,
                department,
                position,
                salary,
                bankDetails: {
                    bankName,
                    accountNumber,
                    bankCode
                },
                hireDate: new Date().toISOString().split('T')[0],
                status: 'Active'
            };
            
            staffMembers.push(staff);
            saveUserData();
            updateStaffTable();
            clearStaffForm();
            updateDashboard();
            showNotification('Staff member added successfully!', 'success');
        }

        function editStaff(id) {
            const staff = staffMembers.find(s => s.id === id);
            if (staff) {
                editingStaffId = id;
                document.getElementById('editStaffName').value = staff.name;
                document.getElementById('editStaffEmail').value = staff.email;
                document.getElementById('editStaffPhone').value = staff.phone;
                document.getElementById('editStaffDepartment').value = staff.department;
                document.getElementById('editStaffPosition').value = staff.position;
                document.getElementById('editStaffSalary').value = staff.salary;
                document.getElementById('editStaffBankName').value = staff.bankDetails.bankName;
                document.getElementById('editStaffAccountNumber').value = staff.bankDetails.accountNumber;
                document.getElementById('editStaffBankCode').value = staff.bankDetails.bankCode;
                
                document.getElementById('editStaffModal').style.display = 'block';
            }
        }

        function updateStaff(event) {
            event.preventDefault();
            if (!editingStaffId) return;
            
            const staffIndex = staffMembers.findIndex(s => s.id === editingStaffId);
            if (staffIndex !== -1) {
                staffMembers[staffIndex] = {
                    ...staffMembers[staffIndex],
                    name: document.getElementById('editStaffName').value,
                    email: document.getElementById('editStaffEmail').value,
                    phone: document.getElementById('editStaffPhone').value,
                    department: document.getElementById('editStaffDepartment').value,
                    position: document.getElementById('editStaffPosition').value,
                    salary: parseFloat(document.getElementById('editStaffSalary').value),
                    bankDetails: {
                        bankName: document.getElementById('editStaffBankName').value,
                        accountNumber: document.getElementById('editStaffAccountNumber').value,
                        bankCode: document.getElementById('editStaffBankCode').value
                    }
                };
                
                saveUserData();
                updateStaffTable();
                closeModal('editStaffModal');
                updateDashboard();
                showNotification('Staff member updated successfully!', 'success');
            }
        }

        function deleteStaff(id) {
            if (confirm('Are you sure you want to delete this staff member?')) {
                staffMembers = staffMembers.filter(s => s.id !== id);
                saveUserData();
                updateStaffTable();
                updateDashboard();
                showNotification('Staff member deleted successfully!', 'success');
            }
        }

        function updateStaffTable() {
            const tbody = document.getElementById('staffTableBody');
            
            if (staffMembers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #999;">No staff members added yet</td></tr>';
                return;
            }
            
            tbody.innerHTML = staffMembers.map(staff => `
                <tr>
                    <td>${staff.name}</td>
                    <td>${staff.email}</td>
                    <td>${staff.department}</td>
                    <td>${staff.position}</td>
                    <td>${formatCurrency(staff.salary)}</td>
                    <td>
                        <strong>${staff.bankDetails.bankName}</strong><br>
                        ${staff.bankDetails.accountNumber}<br>
                        ${staff.bankDetails.bankCode}
                    </td>
                    <td>
                        <button class="btn btn-warning" onclick="editStaff(${staff.id})">✏️</button>
                        <button class="btn btn-danger" onclick="deleteStaff(${staff.id})">🗑️</button>
                    </td>
                </tr>
            `).join('');
        }

        function clearStaffForm() {
            document.getElementById('staffName').value = '';
            document.getElementById('staffEmail').value = '';
            document.getElementById('staffPhone').value = '';
            document.getElementById('staffDepartment').value = '';
            document.getElementById('staffPosition').value = '';
            document.getElementById('staffSalary').value = '';
            document.getElementById('staffBankName').value = '';
            document.getElementById('staffAccountNumber').value = '';
            document.getElementById('staffBankCode').value = '';
        }

        // Payroll System
        function generatePayroll() {
            const month = document.getElementById('payrollMonth').value;
            const type = document.getElementById('payrollType').value;
            
            if (!month) {
                showNotification('Please select a pay period!', 'danger');
                return;
            }
            
            payrollData = staffMembers.map(staff => {
                const baseSalary = staff.salary;
                const overtime = Math.random() * 500; // Random overtime for demo
                const bonuses = Math.random() * 1000; // Random bonuses for demo
                const deductions = baseSalary * 0.15; // 15% deductions (taxes, insurance, etc.)
                const netPay = baseSalary + overtime + bonuses - deductions;
                
                return {
                    id: staff.id,
                    name: staff.name,
                    department: staff.department,
                    baseSalary,
                    overtime,
                    bonuses,
                    deductions,
                    netPay,
                    status: 'Generated',
                    payPeriod: month
                };
            });
            
            updatePayrollTable();
            updatePayrollSummary();
            document.getElementById('payrollResults').classList.remove('hidden');
            showNotification('Payroll generated successfully!', 'success');
        }

        function updatePayrollTable() {
            const tbody = document.getElementById('payrollTableBody');
            
            tbody.innerHTML = payrollData.map(payroll => `
                <tr>
                    <td>${payroll.name}</td>
                    <td>${payroll.department}</td>
                    <td>${formatCurrency(payroll.baseSalary)}</td>
                    <td>${formatCurrency(payroll.overtime)}</td>
                    <td>${formatCurrency(payroll.bonuses)}</td>
                    <td>${formatCurrency(payroll.deductions)}</td>
                    <td><strong>${formatCurrency(payroll.netPay)}</strong></td>
                    <td><span class="badge badge-success">${payroll.status}</span></td>
                </tr>
            `).join('');
        }

        function updatePayrollSummary() {
            const totalBaseSalary = payrollData.reduce((sum, p) => sum + p.baseSalary, 0);
            const totalOvertime = payrollData.reduce((sum, p) => sum + p.overtime, 0);
            const totalBonuses = payrollData.reduce((sum, p) => sum + p.bonuses, 0);
            const totalDeductions = payrollData.reduce((sum, p) => sum + p.deductions, 0);
            const totalNetPay = payrollData.reduce((sum, p) => sum + p.netPay, 0);
            
            document.getElementById('payrollSummary').innerHTML = `
                <div class="salary-item">
                    <h4>💰 Base Salary</h4>
                    <p>${formatCurrency(totalBaseSalary)}</p>
                </div>
                <div class="salary-item">
                    <h4>⏰ Overtime</h4>
                    <p>${formatCurrency(totalOvertime)}</p>
                </div>
                <div class="salary-item">
                    <h4>🎁 Bonuses</h4>
                    <p>${formatCurrency(totalBonuses)}</p>
                </div>
                <div class="salary-item">
                    <h4>📉 Deductions</h4>
                    <p>${formatCurrency(totalDeductions)}</p>
                </div>
                <div class="salary-item">
                    <h4>💸 Net Pay</h4>
                    <p><strong>${formatCurrency(totalNetPay)}</strong></p>
                </div>
            `;
        }

        function exportPayroll() {
            if (payrollData.length === 0) {
                showNotification('Please generate payroll first!', 'warning');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Header
            doc.setFontSize(20);
            doc.setFont('helvetica', 'bold');
            doc.text('Payroll Report', 105, 20, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text(`Company: ${currentUser.company}`, 20, 40);
            doc.text(`Generated: ${new Date().toLocaleDateString()}`, 20, 50);
            
            let yPos = 70;
            
            // Table header
            doc.setFont('helvetica', 'bold');
            doc.text('Employee', 20, yPos);
            doc.text('Department', 60, yPos);
            doc.text('Base Salary', 100, yPos);
            doc.text('Net Pay', 140, yPos);
            yPos += 10;
            
            // Table content
            doc.setFont('helvetica', 'normal');
            payrollData.forEach(payroll => {
                if (yPos > 250) {
                    doc.addPage();
                    yPos = 20;
                }
                
                doc.text(payroll.name, 20, yPos);
                doc.text(payroll.department, 60, yPos);
                doc.text(formatCurrency(payroll.baseSalary), 100, yPos);
                doc.text(formatCurrency(payroll.netPay), 140, yPos);
                yPos += 8;
            });
            
            doc.save(`payroll-${new Date().toISOString().split('T')[0]}.pdf`);
            showNotification('Payroll exported successfully!', 'success');
        }

        // Department Management
        function addDepartment() {
            const name = document.getElementById('deptName').value;
            const manager = document.getElementById('deptManager').value;
            const budget = parseFloat(document.getElementById('deptBudget').value);
            
            if (!name || !manager || !budget) {
                showNotification('Please fill in all fields!', 'danger');
                return;
            }
            
            const department = {
                id: Date.now(),
                name,
                manager,
                budget,
                employees: staffMembers.filter(s => s.department === name).length,
                created: new Date().toISOString()
            };
            
            departments.push(department);
            saveUserData();
            updateDepartmentsList();
            clearDepartmentForm();
            showNotification('Department added successfully!', 'success');
        }

        function updateDepartmentsList() {
            const container = document.getElementById('departmentsList');
            
            if (departments.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">No departments added yet</p>';
                return;
            }
            
            container.innerHTML = departments.map(dept => `
                <div class="card">
                    <h3>🏢 ${dept.name}</h3>
                    <p><strong>Manager:</strong> ${dept.manager}</p>
                    <p><strong>Budget:</strong> ${formatCurrency(dept.budget)}</p>
                    <p><strong>Employees:</strong> ${staffMembers.filter(s => s.department === dept.name).length}</p>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-danger" onclick="deleteDepartment(${dept.id})">🗑️ Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function deleteDepartment(id) {
            if (confirm('Are you sure you want to delete this department?')) {
                departments = departments.filter(d => d.id !== id);
                saveUserData();
                updateDepartmentsList();
                showNotification('Department deleted successfully!', 'success');
            }
        }

        function clearDepartmentForm() {
            document.getElementById('deptName').value = '';
            document.getElementById('deptManager').value = '';
            document.getElementById('deptBudget').value = '';
        }

        // Project Management
        function addProject() {
            const name = document.getElementById('projectName').value;
            const client = document.getElementById('projectClient').value;
            const startDate = document.getElementById('projectStartDate').value;
            const endDate = document.getElementById('projectEndDate').value;
            const status = document.getElementById('projectStatus').value;
            const budget = parseFloat(document.getElementById('projectBudget').value);
            const description = document.getElementById('projectDescription').value;
            
            if (!name || !client || !startDate || !endDate || !budget) {
                showNotification('Please fill in all required fields!', 'danger');
                return;
            }
            
            const project = {
                id: Date.now(),
                name,
                client,
                startDate,
                endDate,
                status,
                budget,
                description,
                created: new Date().toISOString()
            };
            
            projects.push(project);
            saveUserData();
            updateProjectsTable();
            clearProjectForm();
            updateDashboard();
            showNotification('Project added successfully!', 'success');
        }

        function updateProjectsTable() {
            const tbody = document.getElementById('projectsTableBody');
            
            if (projects.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #999;">No projects added yet</td></tr>';
                return;
            }
            
            tbody.innerHTML = projects.map(project => `
                <tr>
                    <td>${project.name}</td>
                    <td>${project.client}</td>
                    <td>${formatDate(project.startDate)}</td>
                    <td>${formatDate(project.endDate)}</td>
                    <td><span class="badge badge-${getStatusColor(project.status)}">${project.status}</span></td>
                    <td>${formatCurrency(project.budget)}</td>
                    <td>
                        <button class="btn btn-warning" onclick="editProject(${project.id})">✏️</button>
                        <button class="btn btn-danger" onclick="deleteProject(${project.id})">🗑️</button>
                    </td>
                </tr>
            `).join('');
        }

        function deleteProject(id) {
            if (confirm('Are you sure you want to delete this project?')) {
                projects = projects.filter(p => p.id !== id);
                saveUserData();
                updateProjectsTable();
                updateDashboard();
                showNotification('Project deleted successfully!', 'success');
            }
        }

        function clearProjectForm() {
            document.getElementById('projectName').value = '';
            document.getElementById('projectClient').value = '';
            document.getElementById('projectStartDate').value = '';
            document.getElementById('projectEndDate').value = '';
            document.getElementById('projectStatus').value = 'planning';
            document.getElementById('projectBudget').value = '';
            document.getElementById('projectDescription').value = '';
        }

        // Dashboard Updates
        function updateDashboard() {
            const totalStaff = staffMembers.length;
            const totalPayroll = staffMembers.reduce((sum, staff) => sum + staff.salary, 0);
            const activeProjects = projects.filter(p => p.status === 'active').length;
            const pendingTasks = Math.floor(Math.random() * 20) + 5; // Random for demo
            
            document.getElementById('totalStaff').textContent = totalStaff;
            document.getElementById('totalPayroll').textContent = formatCurrency(totalPayroll);
            document.getElementById('activeProjects').textContent = activeProjects;
            document.getElementById('pendingTasks').textContent = pendingTasks;
            
            updateRecentActivities();
            updateCharts();
        }

        function updateRecentActivities() {
            const container = document.getElementById('recentActivities');
            const activities = [
                { type: 'staff', message: `${staffMembers.length} staff members managed`, time: '2 hours ago' },
                { type: 'payroll', message: 'Monthly payroll generated', time: '1 day ago' },
                { type: 'project', message: `${projects.length} projects tracked`, time: '3 hours ago' },
                { type: 'department', message: `${departments.length} departments active`, time: '5 hours ago' }
            ];
            
            container.innerHTML = activities.map(activity => `
                <div style="padding: 15px; border-left: 4px solid var(--primary); margin-bottom: 10px; background: #f8f9fa; border-radius: 8px;">
                    <p><strong>${activity.message}</strong></p>
                    <small style="color: #666;">${activity.time}</small>
                </div>
            `).join('');
        }

        // Charts Management
        function initializeCharts() {
            const chartConfigs = [
                { id: 'payrollChart', type: 'line' },
                { id: 'staffChart', type: 'doughnut' },
                { id: 'financialChart', type: 'bar' }
            ];

            chartConfigs.forEach(config => {
                const canvas = document.getElementById(config.id);
                if (canvas) {
                    const ctx = canvas.getContext('2d');
                    charts[config.id] = new Chart(ctx, {
                        type: config.type,
                        data: { labels: [], datasets: [] },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'bottom' }
                            }
                        }
                    });
                }
            });
        }

        function updateCharts() {
            updatePayrollChart();
            updateStaffChart();
            updateFinancialChart();
        }

        function updatePayrollChart() {
            if (!charts.payrollChart) return;

            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
            const payrollData = months.map(() => Math.random() * 50000 + 30000);

            charts.payrollChart.data = {
                labels: months,
                datasets: [{
                    label: 'Monthly Payroll',
                    data: payrollData,
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            };
            charts.payrollChart.update();
        }

        function updateStaffChart() {
            if (!charts.staffChart) return;

            const departmentCounts = {};
            staffMembers.forEach(staff => {
                departmentCounts[staff.department] = (departmentCounts[staff.department] || 0) + 1;
            });

            const labels = Object.keys(departmentCounts);
            const data = Object.values(departmentCounts);

            charts.staffChart.data = {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: [
                        '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
                        '#9966FF', '#FF9F40', '#FF6384', '#C9CBCF'
                    ]
                }]
            };
            charts.staffChart.update();
        }

        function updateFinancialChart() {
            if (!charts.financialChart) return;

            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
            const revenue = months.map(() => Math.random() * 100000 + 50000);
            const expenses = months.map(() => Math.random() * 60000 + 30000);

            charts.financialChart.data = {
                labels: months,
                datasets: [
                    {
                        label: 'Revenue',
                        data: revenue,
                        backgroundColor: '#2ecc71',
                        borderColor: '#27ae60',
                        borderWidth: 1
                    },
                    {
                        label: 'Expenses',
                        data: expenses,
                        backgroundColor: '#e74c3c',
                        borderColor: '#c0392b',
                        borderWidth: 1
                    }
                ]
            };
            charts.financialChart.update();
        }

        // Reports Management
        function updateReports() {
            document.getElementById('metricTotalPayroll').textContent = formatCurrency(staffMembers.reduce((sum, staff) => sum + staff.salary, 0));
            document.getElementById('metricEmployeeCount').textContent = staffMembers.length;
            document.getElementById('metricDepartmentCount').textContent = departments.length;
            document.getElementById('metricActiveProjects').textContent = projects.filter(p => p.status === 'active').length;
        }

        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const reportPeriod = document.getElementById('reportPeriod').value;
            
            showNotification(`${reportType} report generated for ${reportPeriod}!`, 'success');
        }

        function exportReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Header
            doc.setFontSize(20);
            doc.setFont('helvetica', 'bold');
            doc.text('Company Management Report', 105, 20, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text(`Company: ${currentUser.company}`, 20, 40);
            doc.text(`Generated: ${new Date().toLocaleDateString()}`, 20, 50);
            
            let yPos = 70;
            
            // Summary
            doc.setFont('helvetica', 'bold');
            doc.text('Executive Summary:', 20, yPos);
            yPos += 10;
            
            doc.setFont('helvetica', 'normal');
            doc.text(`Total Staff: ${staffMembers.length}`, 20, yPos);
            yPos += 7;
            doc.text(`Total Monthly Payroll: ${formatCurrency(staffMembers.reduce((sum, staff) => sum + staff.salary, 0))}`, 20, yPos);
            yPos += 7;
            doc.text(`Active Projects: ${projects.filter(p => p.status === 'active').length}`, 20, yPos);
            yPos += 7;
            doc.text(`Departments: ${departments.length}`, 20, yPos);
            
            doc.save(`company-report-${new Date().toISOString().split('T')[0]}.pdf`);
            showNotification('Report exported successfully!', 'success');
        }

        // Settings Management
        function saveCompanySettings() {
            companySettings = {
                name: document.getElementById('settingsCompanyName').value,
                address: document.getElementById('settingsCompanyAddress').value,
                phone: document.getElementById('settingsCompanyPhone').value,
                email: document.getElementById('settingsCompanyEmail').value
            };
            
            saveUserData();
            showNotification('Company settings saved successfully!', 'success');
        }

        function saveSystemSettings() {
            systemSettings = {
                currency: document.getElementById('settingsCurrency').value,
                dateFormat: document.getElementById('settingsDateFormat').value,
                payrollFreq: document.getElementById('settingsPayrollFreq').value
            };
            
            saveUserData();
            showNotification('System settings saved successfully!', 'success');
        }

        // Data Management
        function exportAllData() {
            const data = {
                staffMembers,
                departments,
                projects,
                payrollData,
                companySettings,
                systemSettings,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `company-data-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Data exported successfully!', 'success');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(event) {
                const file = event.target.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (confirm('This will replace all current data. Are you sure?')) {
                            staffMembers = data.staffMembers || [];
                            departments = data.departments || [];
                            projects = data.projects || [];
                            payrollData = data.payrollData || [];
                            companySettings = data.companySettings || {};
                            systemSettings = data.systemSettings || systemSettings;
                            
                            saveUserData();
                            updateDashboard();
                            updateStaffTable();
                            updateDepartmentsList();
                            updateProjectsTable();
                            showNotification('Data imported successfully!', 'success');
                        }
                    } catch (error) {
                        showNotification('Invalid file format!', 'danger');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function backupData() {
            exportAllData();
            showNotification('Data backed up successfully!', 'success');
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear ALL data? This cannot be undone!')) {
                if (confirm('This will delete all staff, departments, projects, and settings. Continue?')) {
                    staffMembers = [];
                    departments = [];
                    projects = [];
                    payrollData = [];
                    companySettings = {};
                    
                    saveUserData();
                    updateDashboard();
                    updateStaffTable();
                    updateDepartmentsList();
                    updateProjectsTable();
                    showNotification('All data cleared successfully!', 'success');
                }
            }
        }

        // Utility Functions
        function formatCurrency(amount) {
            const currency = systemSettings.currency || 'USD';
            const symbols = { USD: '$', EUR: '€', GBP: '£', JPY: '¥' };
            return (symbols[currency] || '$') + Math.abs(amount).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const format = systemSettings.dateFormat || 'MM/DD/YYYY';
            
            switch (format) {
                case 'DD/MM/YYYY':
                    return date.toLocaleDateString('en-GB');
                case 'YYYY-MM-DD':
                    return date.toISOString().split('T')[0];
                default:
                    return date.toLocaleDateString('en-US');
            }
        }

        function getStatusColor(status) {
            const colors = {
                'planning': 'warning',
                'active': 'success',
                'completed': 'info',
                'onhold': 'secondary'
            };
            return colors[status] || 'primary';
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.2em;">
                        ${type === 'success' ? '✅' : type === 'danger' ? '❌' : type === 'warning' ? '⚠️' : 'ℹ️'}
                    </span>
                    <span>${message}</span>
                </div>
            `;
            notification.style.background = type === 'success' ? '#d4edda' : type === 'danger' ? '#f8d7da' : type === 'warning' ? '#fff3cd' : '#d1ecf1';
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            editingStaffId = null;
        }

        function quickAction() {
            const actions = [
                { name: 'Add Staff', action: () => showTab('staff') },
                { name: 'Generate Payroll', action: () => showTab('payroll') },
                { name: 'Add Project', action: () => showTab('projects') },
                { name: 'View Reports', action: () => showTab('reports') }
            ];
            
            const action = actions[Math.floor(Math.random() * actions.length)];
            action.action();
            showNotification(`Quick action: ${action.name}`, 'info');
        }

        // Data Persistence
        function saveUserData() {
            const userData = {
                staffMembers,
                departments,
                projects,
                payrollData,
                companySettings,
                systemSettings
            };
            
            localStorage.setItem(`companyData_${currentUser.username}`, JSON.stringify(userData));
        }

        function loadUserData() {
            const savedData = localStorage.getItem(`companyData_${currentUser.username}`);
            if (savedData) {
                const data = JSON.parse(savedData);
                staffMembers = data.staffMembers || [];
                departments = data.departments || [];
                projects = data.projects || [];
                payrollData = data.payrollData || [];
                companySettings = data.companySettings || {};
                systemSettings = data.systemSettings || systemSettings;
                
                updateStaffTable();
                updateDepartmentsList();
                updateProjectsTable();
                
                // Load settings into forms
                if (companySettings.name) {
                    document.getElementById('settingsCompanyName').value = companySettings.name;
                    document.getElementById('settingsCompanyAddress').value = companySettings.address || '';
                    document.getElementById('settingsCompanyPhone').value = companySettings.phone || '';
                    document.getElementById('settingsCompanyEmail').value = companySettings.email || '';
                }
                
                document.getElementById('settingsCurrency').value = systemSettings.currency;
                document.getElementById('settingsDateFormat').value = systemSettings.dateFormat;
                document.getElementById('settingsPayrollFreq').value = systemSettings.payrollFreq;
            }
        }

        // Event Listeners
        function initializeEventListeners() {
            document.getElementById('loginForm').addEventListener('submit', login);
            document.getElementById('registerForm').addEventListener('submit', register);
            document.getElementById('editStaffForm').addEventListener('submit', updateStaff);
            
            // Set current month for payroll
            document.getElementById('payrollMonth').value = new Date().toISOString().slice(0, 7);
            
            // Modal click outside to close
            window.addEventListener('click', function(event) {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    if (event.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    const openModal = document.querySelector('.modal[style*="block"]');
                    if (openModal) {
                        openModal.style.display = 'none';
                    }
                }
            });
        }

        // Auto-save every 30 seconds
        setInterval(() => {
            if (currentUser) {
                saveUserData();
            }
        }, 30000);
        
        // Save data before page unload
        window.addEventListener('beforeunload', () => {
            if (currentUser) {
                saveUserData();
            }
        });
    </script>
</body>
</html>
